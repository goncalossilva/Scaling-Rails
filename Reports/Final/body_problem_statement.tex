\chapter{Problem Statement} % (fold)
\label{cha:problem_statement}
\headermark{Problem Statement}

\section*{} % (fold)
Ruby on Rails applications generally have scalability issues. A significant amount of applications developed using this framework exhibit this issue by publicly starting to suffer from performance and scalability issues as their popularity increases. The Ruby on Rails community is not generally focused in building highly performant systems. The lack of generic centralized information, functional and intuitive profiling tools and global awareness of this subjects's importance all contribute to this problem.

As observable on chapter~\ref{cha:state_of_the_art}, some information regarding benchmarks and configurations of the various components involved in a Rails application exists but it is, however, very scattered. Most tests and configuration evaluations are not generic, focusing on specific components, setups or purposes. It is crucial to create a solid set of conventions and guidelines that are generic and cover all components, approaching benchmarking and tweaking from a unified perspective---optimizing a Ruby on Rails application.

On a related matter, the native profiling tools in Ruby on Rails have never functioned properly when used with Ruby 1.9. While complicating the act of profiling an application, this also prevents some users from switching to this version and leveraging from its increased performance. At the same time, the profiling output formats supported are all text based. Profiling is an essential aspect of increasing an application's performance, so it is very important to fix Ruby and Rails' profiling tools, provide a seamless integration between them and the most recent versions of Ruby and add support for alternate, more intuitive profiling output formats.

As mentioned in chapter~\ref{cha:introduction}, Twitter---and a few other renowned platforms---had many scalability issues which were not discrete, some becoming quite famous. However, the global awareness of the Ruby on Rails community regarding the importance of scalability is still remarkably low. Despite having the Rails 3 API available shortly after its development began back in early 2009 and Ruby 1.9 available since 2008, most plugin developers have not added support for these versions to their plugins. Famous Rails applications, like Redmine, also lack support for Ruby 1.9 and have not started upgrading to Rails 3. Knowing the performance benefits of using the latest versions of both components, it is important to increase the community's \textit{momentum} by updating famous plugins and applications, possibly igniting an update-focused philosophy.

To create a generic guideline with centralized information, improve the current profiling tools and increase the community's sensibility on this subject it is crucial to address specific characteristics, configurations and issues of all components involved with the aforementioned perspective. 

The following sections state and justify the problems addressed in each component.

\section{Operating Systems}
Focusing on finding specific Operating System bottlenecks and solving or improving them is beyond the scope of this project. It is also unlikely to be worthwhile given the time span of the project and its wide area coverage. Furthermore, most operating systems have significant communities discussing, implementing and improving solutions to given bottlenecks.

However, there is need to determine which OS is best suited for Rails applications. The lack of generic benchmarking tools limits one's ability to fairly compare the performance of operating systems. These should be created, taking into account common tasks performed by them. 

Ascertaining which OS best handles web server load with the default configurations is also important to build a starting point for deploying and optimizing Rails applications. 

Finally, as mentioned in section~\ref{tech:sec:ruby}, Ruby is mainly developed in Linux but should easily run on many other operating systems. However, as seen on section~\ref{state:sec:operating_systems}, its performance can greatly differ depending on what OS is running it. The analysis on the performance differences of the Ruby interpreters across operating systems should continue, aside from those already determined.

\section{Ruby}
Ruby 1.9 is supposed to have a noticeably better performance than its ancestor. Most Rails applications were developed with version 1.8 and would highly benefit from the new version's improvements if they were upgraded. It is crucial to determine the benefits of this upgrade to justify the effort needed to accomplish it. 

As explained in section~\ref{state:sec:ruby}, most of the Ruby-related performance bottlenecks found in Rails applications are related to its garbage collector. Despite using a not very optimized garbage collection algorithm---\textit{mark-and-sweep}---it is not configurable, lacking the ability to adapt itself to the application it is running. As seen on section~\ref{tech:sec:ruby}, there are many benefits in having a configurable GC, so it becomes important to give YARV this flexibility. 

Finally, the integration between Rails' profiling and benchmarking tools and Ruby is outdated or, in some cases, nonexistent. It is important to update the existing tools and add support for new information and output formats, therefore improving YARV's data retrieval abilities and its integration with Rails' profiling and benchmarking facilities.

\section{Rails Web Servers}
There are many analysis concerning web server performance but unfortunately most of them are either outdated, not applicable nowadays' setups, not covering a wide range of web servers or lacking relevant data. For instance, the high quality analysis mentioned in~\ref{state:sec:rails_web_servers} does not include Unicorn, nor does it test Mongrel, Passenger and Thin behind other web servers. Furthermore, one of the critically significant but frequently missing aspect in benchmarks is memory usage.

It is also important to analyze the high-load response of each web server by stressing it to its limits and evaluating its behavior from a stability perspective. 

An up-to-date analysis covering raw performance, high-load stability and memory usage is crucial for increasing developers' awareness of the benefits and shortcomings of each web server setup. Since most web servers are natively flexible and configurable, its essential to explore and analyze their configuration options as well.

\section{Databases}
Similarly to the OS component, focusing on finding specific Database bottlenecks and solving or improving them is beyond the scope of this project. It is also unlikely to be worthwhile given the previously stated reasons.

However, Ruby plays an important role concerning databases. The current implementation of the \textit{mysql2} library converts the data between MySQL types and Ruby objects immediately after fetching each row from the database. This behavior is not optimal for situations where there are more fields being fetched than those being used. Changing the program's flow in order to trigger type casting only when the variable is actually accessed---lazy type casting---can have a significant impact on the aforementioned conditions, becoming an important issue to address.

This library is likely to replace Ruby's default in the future. It is being actively developed and provides significant ameliorations from the current library, \textit{mysql}. It is starting to gain a solid reputation within the Ruby community, posing as an excellent target for improvements concerning this component.

\section{Ruby on Rails}
The current native profiling tools for Ruby on Rails are deprecated. They do not function properly on up-to-date environments and they highly depend on Ruby's profiling abilities which are very limited. Improving Ruby's profiling tools is not enough as they need to seamlessly integrate with Rails'. For this to happen, Rails must also targeted for improvements by refactoring and improving the existent non-functional profiling tools.

Rails 3's performance is significantly better when comparing to its predecessor, as mentioned in section~\ref{state:sec:ruby_on_rails}. However, the adoption of Rails 3 will probably be difficult and lengthy since applications need to be refactored and most plugins---one of the main advantages of this framework as explained in section~\ref{tech:sec:ruby_on_rails}---need to be rewritten. To motivate its early adoption and increase this version's \textit{momentum}, some of the most famous plugins need to be ported to the new version. Getting one of the most famous applications---Redmine---to work properly on Rails 3 would also increase the awareness of the new versions' benefits. Finally, some performance bottlenecks commonly found in Rails applications for whose simple solutions exist should also addressed.

\begin{comment}
Rails scalability should be easily accessible to everyone

Improve existing tools, create/improve measurement tools

Missing performance-oriented guidelines and conventions

Missing and out-dated tools to profile Rails applications

Optimal configurations and setups
\end{comment}
