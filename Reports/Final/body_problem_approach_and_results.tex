\chapter{Problem Approach and Results} % (fold)
\label{cha:problem_approach_and_results}
\headermark{Problem Approach and Results}

Envisioning a system-wide performance optimization of a Ruby on Rails application requires targeting all the components involved from the previously mentioned centric perspective---Ruby on Rails. Conducting benchmarks, tweaking configurations, developing improved solutions and evaluating the results must be accomplished with this philosophy in mind. 

It is also necessary to perform these activities using a fair base of comparison. The most important rules used when benchmarking were:
\begin{description}
  \item[Same tests:] Use the same tests when testing component alternatives and, when impossible, keep their disparities to a minimum.
  \item[Same hardware:] Use the same hardware when testing a given component.
  \item[Similar configurations:] Use equal or, at the very least, similar configurations for all the components involved. Exceptions can be made when the purpose of the test is to benchmark the behavior with the default configurations.
\end{description}

Two distinct machines were used during this research. Due to hardware malfunction, the initial computer had to be replaced with a different one. ``Machine 1'' one was used on all the OS-related work, while ``Machine 2'' was used for all the activities related to the remaining components. Their specifications are listed on table~\ref{tab:machines_hardware_specification}.
\begin{table}[ht]
  \centering
  \caption{Hardware Specifications of the Machines in Use}
  \label{tab:machines_hardware_specification}
  
  \begin{tabular}{p{0.085\textwidth}|p{0.42\textwidth}|p{0.42\textwidth}}
    & \multicolumn{1}{c|}{\textbf{\textsc{Machine 1}}} & \multicolumn{1}{c}{\textbf{\textsc{Machine 2}}} \\ \hline

    \textbf{\textsc{CPU}} & Intel Core 2 Quad Q9300 @ 2.50GHz (FSB @ 1333MHz) & Intel Core 2 Duo ~\,E8400 @ 3.0GHz (FSB @ 1333MHz) \\ \hline
    \textbf{\textsc{RAM}} & 2x2GB DDR2 (800 MHz, Dual Channel) & 4x2GB DDR2 (800 MHz, Dual Channel) \\ \hline
    \textbf{\textsc{Hard Drive}} & Seagate ST3500620AS 500GB SATA, 16MB Cache & Seagate ST3750630AS 750GB SATA, 16MB Cache \\
  
  \end{tabular}
\end{table}

When benchmarking, the same software versions were used across all systems and environments. Table~\ref{tab:software_versions} shows the software versions that were used.
\begin{table}[ht]
  \centering
  \caption{Software Versions in Use}
  \label{tab:software_versions}
  
  \begin{tabular}{p{0.25\textwidth}|p{0.25\textwidth}}
    \multicolumn{1}{c|}{\textbf{\textsc{Software/Package}}} & \multicolumn{1}{c}{\textbf{\textsc{Version}}} \\ \hline
    
    MRI & 1.8.7 (patchlevel 249) \\ \hline
    YARV & 1.9.1 (patchlevel 378) \\ \hline
    Rails & 2.3.5 \\ \hline
    FreeBSD & 8 \\ \hline
    Linux Kernel & 2.6.26 \\ \hline
    hdparm & 9.15 \\ \hline
    gzip & 1.3.12 \\ \hline
    lame & 3.98.2 \\ \hline
    vorbis-tools & 1.2.0 \\ \hline
    Apache & 2.2.14 \\ \hline
    Nginx & 0.7.64 \\ \hline
    Cherokee & 0.99.42 \\ \hline
    Thin & 1.2.7 \\ \hline
    Unicorn & 0.97.0 \\ \hline
    Passenger & 2.2.11 \\ \hline
    autobench & 2.1.2 \\ \hline
    httperf & 0.9.0 \\ \hline
    GCC & 4.3.4 \\
        
  \end{tabular}
\end{table}
All packages were compiled from source using GCC with \textit{``-O2 -march=nocona -pipe''} as their compilation flags.

To achieve the objectives established in Chapter~\ref{cha:problem_statement}, some activities were performed.

First of all, to create the centralized set of conventions and guidelines for improving the performance of Ruby on Rails applications, there is the need to analyze and benchmark all worthy alternatives for each component.

In order to easen the process of profiling Rails applications, the native profiling tools must be fixed and upgraded. Rails and Ruby must be improved and tweaked to accommodate all changes, providing a seamless integration between each other's tools.

Finally, to improve the global awareness of this issue's importance there is the need to gather the benefits associated with it, provide a smoother transition by updating renowed Rails plugins, increase this subjects' notoriety by updating one of the most renowned Ruby on Rails projects---Redmine---and by publishing a series of articles about performance optimization on the \textit{Rails Magazine} and, ultimately, initiate a performance-oriented continuous integration for Rails by developing a benchmarking suite aimed at the framework itself. % FIXME: transition?

In order to accomplish the aforementioned tasks, every component was specifically addressed. The work done is presented and explained in the following sections.

\input{solution_operating_systems}
\input{solution_ruby}
\input{solution_rails_web_servers}
\input{solution_databases}
\input{solution_rails}

